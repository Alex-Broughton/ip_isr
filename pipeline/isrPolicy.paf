#<?cfg paf policy ?>
#
# MAIN ISR POLICY FILE
# Created Aug 10, 2008
# Author: Nicole M.Silvestri
#         University of Washington
#         nms@astro.washington.edu
# Version: 1.0 - last updated Tue Nov 02, 2008

######################################
# GENERAL ISR PIPELINE INFORMATION

# Debugging/testing? (boolean)
debugIO: false

# Does a Bad Pixel Mask exist? (boolean)
bpm: true

# Size of Chunk (FPA, RAFT, CCD, AMP, OTHER)
chunkType: AMP

# Is urrent ISR run Nightly or Data Release Processing?
run: DR #('DR' or 'nightly')

########################################
# SATURATION CORRECTION STAGE POLICY	
	
saturationPolicy: {

 # Does a Saturation Lookup Table exist? (boolean)
 satTable: false
 
 # Saturation Lookup Table Name
 satTableName: saturationLookupTable.tab

 # Use the default saturation limit in the policy file? (boolean)
 useDefSat: true

 # Threshold for saturated pixel detection if not found elsewhere
 threshold: 65535 #ADUs - CFHT limit

 # Minimum number of saturated pixels to be detected in a footprint
 nSatPixMin: 1

 # Number of pixels to grow around footprints
 grow: 1

 # FWHM estimate for the PSF (needed for interpolation)
 psfFWHM: 5

}

########################################
# OVERSCAN CORRECT AND TRIM STAGE

overscanPolicy: {

 # Fit a constant value or function ('CONSTANT' or 'FUNCTION')?
 method: CONSTANT

 # Functional form, 1D only ('POLYNOMIAL', 'SPLINE', CHEBYCHEV) 
 funcForm: POLYNOMIAL
 funcOrder: 3
 # Parameters for the minimization
 stepSize: 1.0 # some reasonable guess at a step size
 numParams: 4 # number of parameters to start with

 # Method for determining the constant value ('MEAN', 'MEDIAN', 'AVERAGE', 'MODE')
 constantMeth: MEAN

 # Smooth the image or overscan region?
 smooth: false

 # Smoothing function (BOXCAR or GAUSSIAN)
 smoothOpt: BOXCAR
 smoothOrder: 3
 # if gaussian:
 smoothSigma: 4

 # Want to sigma-clip the image?
 sigClip: false
 sigClipVal: 3

 # header keywords for conversion to LSST standard keys in ISR 
 # TO DO: these will be removed and rectified in the data format stage eventually 
 # datasec: DATASEC
 # biassec: BIASSEC
 # trimsec: TRIMSEC
 datasec: DSECA
 biassec: BSECA
 trimsec: TSECA

}

######################################
# BIAS CORRECTION STAGE

biasPolicy: {

 # Want to sigma-clip the exposure?
 sigClip: false
 sigClipVal: 3

 # Additional scaling of the master bias?
 biasScale: 1.0

# Chunk field name (for AMP or CCD)
 chunkFields: AMPLIST
 chunkFields: AMPNAME

# File Name field from the Metadata
fileName: FILENAME

}

######################################
# DARK CURRENT CORRECTION STAGE

darkPolicy: {

 # Want to sigma-clip the exposure?
 sigClip: false
 sigClipValue: 3

 # Additional scaling of the master dark (beyond EXPTIME scale)?
 darkScale: 1.0

# Chunk field name (for AMP or CCD)
 chunkField: AMPLIST

# File Name field from the Metadata
 fileName: FILENAME

# Field name for Exposure and DarkTime
 exptimeField: EXPTIME
 darktimeField: DARKTIME

}

######################################
# LINEARIZATION STAGE

linearizePolicy: {

 # Does a Linearization Lookup Table exist? (boolean)
 linTable: true
 lookupTableName: linearizationLookupTable.paf

 # For FUNCTION fitting below

 # Perform a functional fit or use a lookup table (FUNCTION or LOOKUP)
 linearizeType: LOOKUP

 # Functional form, 1D only (POLINOMIAL, SPLINE, CHEBYCHEV)
 funcForm: POLYNOMIAL
 funcOrder: 3
 # Parameters for the minimization
 stepSize: 1.0 # some reasonable guess at a step size
 numParams: 4 # number of parameters to start with 

}

######################################
# FLAT FIELD CORRECTION STAGE

flatPolicy: {
 
 
 # Want to stretch the image?
 stretchFactor: 1.0

 # Want to sigma-clip the image?
 sigClip: false
 sigClipVal: 3
 
 # Additional scaling of the master flat
 flatScale: 1.0

}

######################################
# ILLUMINATION CORRECTION STAGE(S)

illuminationPolicy: {

 # effective smoothing kernel size = binSize * kernelSize
 binSize: 4 # in pixels

 # Type of kernel to smooth with (GAUSSIAN, BOXCAR)?
 kernelType: GAUSSIAN
 kernelWidth: 5  # sigma
 kernelRow: 5 # size of kernel, number of cols
 kernelCol: 5 # size of kernel, number of rows

 # file name (incl. path) of a previous night's Master Dome Flat (if running for nightly)
 dfPrevious:  
 
 # file name (incl. path) of the current night's Night Sky Flat (if running for DR)
 sfCurrent:   

 # file name (incl. path) of a previous night's Nights illum. corr. (if running for nightly)
 icPrevious:  tempIlumCorMaskedImage 

 # file name  (incl. path) of the Ilum. Corr. MaskedIamge
 illumMiName: tempIlumCorMaskedImage 

}

######################################
# PUPIL IMAGE CORRECTION STAGE

pupilPolicy: {


}

######################################
# FRINGE CORRECTION STAGE

fringePolicy: {

 # Want to stretch the image?
 stretchFactor: 1.0

 # Want to sigma-clip the image?
 sigClip: false
 sigClipVal: 3

 # Additional scaling of the master fringe
 fringeScale: 1.0

}

######################################
# ADDITIONAL DC3B STAGES HERE



######################################
# END MAIN ISR POLICY FILE
